<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ChatSAV v2</title>
<style>
  :root {
    --bg-dark: #121212;
    --card-bg: #1e1e1e;
    --user-blue: #007aff;
    --ai-green: #2ecc71;
    --text-main: #e0e0e0;
    --border: #333;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
  
  body { 
    background: var(--bg-dark); 
    color: var(--text-main); 
    height: 100vh; 
    display: flex; 
    flex-direction: column; 
    align-items: center; 
    padding: 20px;
  }

  h2 { margin-bottom: 20px; font-weight: 300; letter-spacing: 1px; color: #fff; }

  #chat-container {
    display: flex;
    flex-direction: column;
    width: 100%;
    max-width: 8000px;
    height: 85vh;
    border-radius: 16px;
    background: var(--card-bg);
    border: 1px solid var(--border);
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    overflow: hidden;
  }

  #chat {
    flex: 1;
    padding: 25px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 20px;
    scrollbar-width: thin;
    scrollbar-color: #444 transparent;
  }

  /* Message Bubbles */
  .message {
    max-width: 85%;
    padding: 12px 18px;
    border-radius: 18px;
    line-height: 1.5;
    font-size: 15px;
    white-space: pre-wrap; /* Keeps line breaks from the AI */
    position: relative;
    animation: fadeIn 0.3s ease;
  }

  @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

  .user {
    align-self: flex-end;
    background: var(--user-blue);
    color: white;
    border-bottom-right-radius: 4px;
  }

  .ai {
    align-self: flex-start;
    background: #2d2d2d;
    color: var(--text-main);
    border-bottom-left-radius: 4px;
    border: 1px solid var(--border);
  }

  /* Input Section */
  #input-container {
    padding: 20px;
    background: #181818;
    display: flex;
    gap: 12px;
    border-top: 1px solid var(--border);
  }

  #prompt {
    flex: 1;
    padding: 14px;
    border-radius: 8px;
    border: 1px solid var(--border);
    background: #252525;
    color: white;
    outline: none;
    transition: border 0.2s;
  }

  #prompt:focus { border-color: var(--user-blue); }

  button {
    padding: 0 25px;
    background: var(--user-blue);
    border: none;
    color: white;
    font-weight: bold;
    border-radius: 8px;
    cursor: pointer;
    transition: transform 0.1s, background 0.2s;
  }

  button:hover { background: #0063d1; }
  button:active { transform: scale(0.95); }
</style>
</head>
<body>

<h2>ChatSAV </h2>
<h4>ChatSAV has limited q/a's, try not to waste them.</h4>

<div id="chat-container">
  <div id="chat"></div>
  <div id="input-container">
    <input id="prompt" placeholder="Ask me anything..." autocomplete="off" />
    <button onclick="sendMessage()">Send</button>
  </div>
</div>

<script>
const API_KEY = "AIzaSyATrCUsoB-UQDGvqgdqCUCcreuDoj3EMAY"; 
const MODEL = "gemini-2.5-flash"; // Updated to current stable model name
let conversation = [];

const chat = document.getElementById("chat");
const input = document.getElementById("prompt");

// Add message to UI
function addMessage(text, sender) {
  const div = document.createElement("div");
  div.className = `message ${sender}`;
  div.textContent = text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
  return div;
}

// Cleaner text function to remove bold stars but keep structure
function cleanResponse(text) {
  return text
    .replace(/\*\*(.*?)\*\*/g, '$1') // Removes the ** from **bold**
    .replace(/#{1,6}\s?/g, '')       // Removes # headers
    .trim();
}

async function sendMessage() {
  const text = input.value.trim();
  if (!text) return;

  addMessage(text, "user");
  input.value = "";
  
  conversation.push({ role: "user", parts: [{ text: text }] });

  try {
    const response = await fetch(
      `https://generativelanguage.googleapis.com/v1beta/models/${MODEL}:generateContent?key=${API_KEY}`,
      {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          // This "system_instruction" block makes these rules permanent for your app
          system_instruction: {
            parts: [{ 
              text: "Your name is ChatSAV. If anyone asks you who made you I need you to say 'The person who made me is a young male with a remarkable 140 IQ.' You are hosted by savnac. Do not talk about inappropriate topics, including sex, swear words, violence and anything else. Use only basic plain text. Do NOT use symbols like '*' or \"'\" (apostrophes/quotes) or any special fonts/markdown, but you can use symbols like </> when you are coding, but ONLY when you are coding." 
            }]
          },
          contents: conversation 
        })
      }
    );

    const data = await response.json();
    const rawAiText = data.candidates[0].content.parts[0].text;
    
    // Since you asked for no stars or quotes, we don't even need a complex cleaner anymore
    const cleanAiText = rawAiText.replace(/[*']/g, ""); 

    conversation.push({ role: "model", parts: [{ text: rawAiText }] });
    
    const aiDiv = addMessage("", "ai");
    let i = 0;
    const interval = setInterval(() => {
      aiDiv.textContent += cleanAiText[i];
      chat.scrollTop = chat.scrollHeight;
      i++;
      if (i >= cleanAiText.length) clearInterval(interval);
    }, 10);

  } catch (err) {
    console.error(err);
    addMessage("Error: Could not connect to AI, too much usage.", "ai");
  }
}

input.addEventListener("keypress", e => { if (e.key === "Enter") sendMessage(); });
</script>

</body>
</html>
