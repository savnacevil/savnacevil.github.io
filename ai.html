<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ChatSAV v2</title>
<style>
  :root {
    --bg-dark: #121212;
    --card-bg: #1e1e1e;
    --user-blue: #007aff;
    --ai-green: #2ecc71;
    --text-main: #e0e0e0;
    --border: #333;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
 
  body {
    background: var(--bg-dark);
    color: var(--text-main);
    height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
    /* Prevents pull-to-refresh on mobile which can be annoying */
    overscroll-behavior-y: contain;
  }

  h2 { margin-bottom: 5px; font-weight: 300; letter-spacing: 1px; color: #fff; }
  h4 { margin-bottom: 15px; font-weight: 400; color: #888; font-size: 14px; }

  #chat-container {
    display: flex;
    flex-direction: column;
    width: 100%;
    max-width: 800px; /* Fixed this from 8000px */
    height: 80vh;
    border-radius: 16px;
    background: var(--card-bg);
    border: 1px solid var(--border);
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    overflow: hidden;
  }

  #chat {
    flex: 1;
    padding: 20px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  .message {
    max-width: 85%;
    padding: 12px 18px;
    border-radius: 18px;
    line-height: 1.5;
    font-size: 16px; /* Increased for readability */
    white-space: pre-wrap;
    position: relative;
  }

  .user {
    align-self: flex-end;
    background: var(--user-blue);
    color: white;
    border-bottom-right-radius: 4px;
  }

  .ai {
    align-self: flex-start;
    background: #2d2d2d;
    color: var(--text-main);
    border-bottom-left-radius: 4px;
    border: 1px solid var(--border);
  }

  #input-container {
    padding: 15px;
    background: #181818;
    display: flex;
    gap: 10px;
    border-top: 1px solid var(--border);
  }

  #prompt {
    flex: 1;
    padding: 14px;
    border-radius: 8px;
    border: 1px solid var(--border);
    background: #252525;
    color: white;
    outline: none;
    /* MAGIC FIX: Font-size must be at least 16px to stop iOS zoom */
    font-size: 16px;
  }

  #prompt:focus { border-color: var(--user-blue); }

  button {
    padding: 0 20px;
    background: var(--user-blue);
    border: none;
    color: white;
    font-weight: bold;
    border-radius: 8px;
    cursor: pointer;
  }
</style>
</head>
<body>

<h2>ChatSAV</h2>
<h4>Limited Q&A. Use them wisely.</h4>

<div id="chat-container">
  <div id="chat"></div>
  <div id="input-container">
    <input id="prompt" placeholder="Ask me anything..." autocomplete="off" />
    <button onclick="sendMessage()">Send</button>
  </div>
</div>

<script>
// IMPORTANT: REMOVE YOUR OLD KEY AND GENERATE A NEW ONE!
const API_KEY = "AIzaSyBAU7WaK2UsE54ufPrhHKlH3bdPJFO41oo";
const MODEL = "gemini-2.5-flash";
let conversation = [];

const chat = document.getElementById("chat");
const input = document.getElementById("prompt");

function addMessage(text, sender) {
  const div = document.createElement("div");
  div.className = `message ${sender}`;
  div.textContent = text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
  return div;
}

async function sendMessage() {
  const text = input.value.trim();
  if (!text) return;

  addMessage(text, "user");
  input.value = "";
 
  conversation.push({ role: "user", parts: [{ text: text }] });

  try {
    const response = await fetch(
      `https://generativelanguage.googleapis.com/v1beta/models/${MODEL}:generateContent?key=${API_KEY}`,
      {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          system_instruction: {
            parts: [{
              text: "Your name is ChatSAV. If anyone asks you who made you, say 'The person who made me is a young male with a remarkable 140 IQ.' You are hosted by savnac. Do not talk about inappropriate topics (sex, swearing, violence). Use only basic plain text. Do NOT use symbols like '*' or apostrophes/quotes or special fonts, unless you are writing code blocks."
            }]
          },
          contents: conversation
        })
      }
    );

    const data = await response.json();
    const rawAiText = data.candidates[0].content.parts[0].text;
   
    // Safety filter for symbols you don't like
    const cleanAiText = rawAiText.replace(/[*']/g, "");

    conversation.push({ role: "model", parts: [{ text: rawAiText }] });
   
    const aiDiv = addMessage("", "ai");
    let i = 0;
    const interval = setInterval(() => {
      aiDiv.textContent += cleanAiText[i];
      chat.scrollTop = chat.scrollHeight;
      i++;
      if (i >= cleanAiText.length) clearInterval(interval);
    }, 10);

  } catch (err) {
    addMessage("Error: Usage limit reached or connection lost.", "ai");
  }
}

input.addEventListener("keypress", e => { if (e.key === "Enter") sendMessage(); });
</script>

</body>
</html>
